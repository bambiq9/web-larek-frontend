# Проектная работа "Веб-ларек"
https://github.com/bambiq9/web-larek-frontend.git

Работа приложения строится на основе шаблона Model-View-Presenter (MVP) и использует событийно-ориентированный подход.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Классы Model

### 1. `ProductListModel`

Отвечает за работу с товарами магазина.
Хранит все доступные товары в свойстве `_products`.
Принимает экземпляр эмиттера событий `EventEmitter`

#### Методы:
- `getProducts` — возвращает список товаров
- `getProduct` — возвращает товар по его id
- `setProducts` — обновляет список товаров в свойстве `_products`, а также вызывает событие `productList:set`.

### 2. ProductListApi

Получает адрес API в конструкторе. 

#### Методы:
- `getProducts` отправляет запрос на получение данных о товарах. Вызывает событие `productList:get` или `productList:error`.
- `getProduct` — получает данные об одном товаре.

### 3. `CartModel`

Модель корзины. Хранит товары, добавленные в корзину, в свойстве `_products`. Товары хранятся в объекте Map.
Также принимает `EventEmitter`.

#### Методы:
- `addProduct` — добавляет товар в корзину. Вызывает событие `cart:add`
- `removeProduct` — удаляет товар из корзины. Вызывает событие `cart:remove`
- `getProducts` — возвращает список товаров в корзине
- `getTotalPrice` — возвращает сумму всех товаров в корзине
- `clearCart` — очищает корзину

### 4. `OrderState`

Управляет состоянием заказа через сеттеры и методом `getState` возвращает объект для отправки данных заказа на сервер.

## Классы View

### 1. `View`

Абстрактный класс. Реализация принимает HTML-контейнер `_container`, в котором будет отображаться результат работы класса.

Метод `render` отвечает за отображение элемента. Реализация может разлтичаться в зависимости от нужд класса. В качестве параметров принимает объект неопределенного типа, которыйы может быть использован частично.

Наследуется всеми представлениями в приложении.

### 2. `ProductView` 

Содержит в себе данные товара для их последующего отображения в карточке.
Помимо этого присутствуют свойства для кнопок добавления товара в корзину `_addButton` и удаления `_deleteButton`.

При нажатии на карточку, вызывается событие `product:click`.

Метод `render` отображает карточку товара или его элемент в корзине.

### 3. `ProductListView`

Представление списка товаров магазина.

Метод `render` отображает массив HTML-элементов `ProductView` в контейнере `_productListContainer`.

### 4. `CartView`

Отображение корзины. `_totalPriceElement` отображает полную стоимость всех товаров в корзине.
При нажатии на кнопку `_submitButton` срабатывает событие `submit`.

Метод `render` обновляет отображение данных корзины.

### 5. `Form`

Принимает `template` формы. 

#### Методы:
- `clear` — очистка полей формы
- `setInputs` — сохраняет NodeList всех полей формы в свойство `_inputs`
- `validateInput` — валидация поля
- `validateForm` — валидация всей формы
- `setPaymentMethod` — указывает значение свойства `_paymentMethof` на один из типов оплаты, перечисленных в enum `PaymentMethods`. Вызывает событие `cart:paymentMethod`
- `showError` — отображает ошибку при валидации поля
- `hideError` — скрывает ошибку
- `setDisabled` — устанавливает аттрибут `disabled` на элементе

### 6. `Modal`

В конструкторе создаются слушатели событий `click` на `_closeButton` и `_container` для закрытия модального окна.

#### Методы:
- `open` — отображает модальное окно. Вызывает событие `modal:open`
- `close` — скрывает модальное окно. Вызывает событие `modal:close`
- `getView` — возвращает HTML-элемент из шаблона одного из представлений модального окна. Выбор шаблона осуществляется по id
- `setView` — отображает выбранное представление в модальном окне

## Работа с событиями

Для работы с событиями используется класс `EventEmitter`.
Его методы `on`, `off` и `emit` позволяют установить, снять обработчики событий, а также вызвать само событие.

### Список событий:

- `OrderCreate = 'order:create'` — форма заказа успешно заполнена
- `OrderSucess = 'order:success'` — получен успешный ответ на заказ с сервера
- `OrderError = 'order:error'` — сервер вернул ошибку
- `CartAdd = 'cart:add'` — добавлен товар в корзину
- `CartRemove = 'cart:remove'` — товар удален из корзины
- `CartPaymentMethod = 'cart:paymentMethod'` — изменен метод оплаты заказа
- `ModalOpen = 'modal:open'` — открытие модального окна
- `ModalClose = 'modal:close'` — закрытие модального окна
- `ProductListGetSuccess = 'productList:get'` — успешно получен список товаров с API
- `ProductListGetError = 'productList:error'` — запрос списка товаров вернул ошибку
- `ProductListSet = 'productList:set'` — обновили список товаров в модели
- `ProductClick = 'product:click'` — нажатие на товар в списке

## Ключевые типы данных

### Товары
```ts
// Данные товара приходят с сервера в следующем виде: 
type IProduct = {
  title: string; // Название товара
  image: string; // Адрес изображения для карточки
  category: Categories; // Категория
  description: string; // Описание
  price: number; // Цена
  id: string; // Идентификатор
}
```
### Состояние формы заказа
```ts
// Формат хранения данных формы заказа для отправки на сервер
type OrderStateType = {
  email: string; // Почта пользователя
  phone: string; // Телефон
  address: string; // Адрес доставки
  payment: PaymentMethods; // Выбранный метод оплаты
  total: number, // Общая сумма выбранных товаров
  items: string[], // Массив идентификаторов заказанных товаров
}
```

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```